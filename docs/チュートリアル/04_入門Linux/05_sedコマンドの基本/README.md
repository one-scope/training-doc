[戻る](../README.md)

# `sed` コマンドの基本

- [`sed` コマンドの基本](#sed-コマンドの基本)
  - [`sed` コマンドとは](#sed-コマンドとは)
  - [基本的な使いかた](#基本的な使いかた)
    - [主なオプション](#主なオプション)
  - [スクリプトの基本的な構成](#スクリプトの基本的な構成)
    - [アドレス](#アドレス)
    - [コマンド](#コマンド)
  - [スクリプト例](#スクリプト例)
    - [置換するスクリプト](#置換するスクリプト)
    - [削除するスクリプト](#削除するスクリプト)

## `sed` コマンドとは

`sed` コマンドは、ファイルに対して様々なテキスト処理を行うコマンドです。

## 基本的な使いかた

`sed` コマンドの基本的な構文は次のとおりです。

```bash
sed [オプション] "スクリプト" 処理対象のファイル名
```

### 主なオプション

| オプション      | 意味                                                                |
| --------------- | ------------------------------------------------------------------- |
| `-i`            | 処理対象のファイルを直接変更する                                    |
| `-E`            | 拡張正規表現(Extended Regular Expressions)をつかう                  |
| `-e スクリプト` | スクリプトを指定する<br/>※ 複数のスクリプトを指定する場合に使用する |

## スクリプトの基本的な構成

スクリプトはアドレスとコマンドで構成されます。  
アドレスは処理を適用する行を指定する部分です。  
コマンドは行に対して実行する処理内容を指定する部分です。  
スクリプトは `アドレスコマンド` のようにアドレスとコマンドを続けて記述します。

### アドレス

| アドレス                  | 意味                                                            |
| ------------------------- | --------------------------------------------------------------- |
| `{行番号}`                | `{行番号}` 行目の行                                             |
| `$`                       | 最終行                                                          |
| `/{検索パターン}/`        | `{検索パターン}` にマッチした行                                 |
| `{アドレス1},{アドレス2}` | `{アドレス1}` の行から `{アドレス2}` の行                       |
| `{アドレス},+{行数}`      | `{アドレス}` の行から `{行数}` 行までの行                       |
| `{アドレス},~{ステップ}`  | `{アドレス}` の行からはじめて `{ステップ}` 行ずつスキップした行 |
| `{アドレス}!`             | `{アドレス}` の行以外の行                                       |

### コマンド

| コマンド                                                 | 意味                                                                                                                                |
| -------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `s/{検索パターン}/{置換後の文字列}/`                     | 行の内容のうち `{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える                                                |
| `s/{検索パターン}/{置換後の文字列}/g`                    | 行の内容のうち `{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換え |
| `y/{置き換える文字のセット}/{置き換え後の文字のセット}/` | 行の内容を `{置き換える文字のセット}` を1文字ずつ照らし合わせ、`{置き換え後の文字のセット}` 内の対応する文字に置き換える            |
| `a {新しい行の内容}`                                     | 行の後に `{新しい行の内容}` を新しい行として追加する                                                                                |
| `i {新しい行の内容}`                                     | 行の前に `{新しい行の内容}` を新しい行として挿入する                                                                                |
| `c {更新後の行の内容}`                                   | 行を `{更新後の行の内容}` に置き換える                                                                                              |
| `d`                                                      | 行を削除する                                                                                                                        |
| `r {ファイル名}`                                         | 行の後に `{ファイル名}` のファイルの内容を追加する                                                                                  |
| `w {ファイル名}`                                         | 行を `{ファイル名}` のファイルに書き込むる                                                                                          |
| `p`                                                      | 行を表示する                                                                                                                        |
| `=`                                                      | 行番号を表示する                                                                                                                    |
| `l {折り返し文字数}`                                     | 行を `{折り返し文字数}` で折り返して表示する                                                                                        |
| `#`                                                      | コメント                                                                                                                            |
| `n`                                                      | 行の処理を終了し、次の行に進む行                                                                                                    |
| `q`                                                      | 行を処理したのち、処理を終了する                                                                                                    |
| `Q {終了コード}`                                         | 行を処理したのち、`{終了コード}` で処理を終了する                                                                                   |

## スクリプト例

### 置換するスクリプト

| スクリプト                                                                 | 意味                                                                                                                                                                                                           |
| -------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `s/{検索パターン}/{置換後の文字列}/`                                       | `{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                                                                       |
| `s/{検索パターン}/{置換後の文字列}/g`                                      | `{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                                                                         |
| `{行番号}s/{検索パターン}/{置換後の文字列}/`                               | `{行番号}` 行目の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                                            |
| `{行番号}s/{検索パターン}/{置換後の文字列}/g`                              | `{行番号}` 行目の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                                              |
| `{行番号}!s/{検索パターン}/{置換後の文字列}/`                              | `{行番号}` 行目以外の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                                        |
| `{行番号}!s/{検索パターン}/{置換後の文字列}/g`                             | `{行番号}` 行目以外の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                                          |
| `{行番号1},{行番号2}s/{検索パターン}/{置換後の文字列}/`                    | `{行番号1}` 行目から `{行番号2}` 行目の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                      |
| `{行番号1},{行番号2}s/{検索パターン}/{置換後の文字列}/g`                   | `{行番号1}` 行目から `{行番号2}` 行目の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                        |
| `{行番号1},{行番号2}!s/{検索パターン}/{置換後の文字列}/`                   | `{行番号1}` 行目から `{行番号2}` 行目以外の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                  |
| `{行番号1},{行番号2}!s/{検索パターン}/{置換後の文字列}/g`                  | `{行番号1}` 行目から `{行番号2}` 行目以外の行のうち、`{検索パターン}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                    |
| `/{検索パターン1}/s/{検索パターン2}/{置換後の文字列}/`                     | `{検索パターン1}` にマッチする行のうち、`{検索パターン2}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                              |
| `/{検索パターン1}/s/{検索パターン2}/{置換後の文字列}/g`                    | `{検索パターン1}` にマッチする行のうち、`{検索パターン2}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                                |
| `/{検索パターン1}/!s/{検索パターン2}/{置換後の文字列}/`                    | `{検索パターン1}` にマッチする行以外の行のうち、`{検索パターン2}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える                                      |
| `/{検索パターン1}/!s/{検索パターン2}/{置換後の文字列}/g`                   | `{検索パターン1}` にマッチする行以外の行のうち、`{検索パターン2}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える                                        |
| `/{検索パターン1}/,/{検索パターン2}/s/{検索パターン3}/{置換後の文字列}/`   | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行のうち、`{検索パターン3}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える         |
| `/{検索パターン1}/,/{検索パターン2}/s/{検索パターン3}/{置換後の文字列}/g`  | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行のうち、`{検索パターン3}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える           |
| `/{検索パターン1}/,/{検索パターン2}/!s/{検索パターン3}/{置換後の文字列}/`  | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行以外の行のうち、`{検索パターン3}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内の最初にマッチした文字列のみを置き換える |
| `/{検索パターン1}/,/{検索パターン2}/!s/{検索パターン3}/{置換後の文字列}/g` | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行以外の行のうち、`{検索パターン3}` にマッチした文字列を `{置換後の文字列}` に置き換える<br/>※ 行内のマッチするすべての文字列を置き換える   |

### 削除するスクリプト

| スクリプト                             | 意味                                                                                    |
| -------------------------------------- | --------------------------------------------------------------------------------------- |
| `{行番号}d`                            | `{行番号}` 行目の行を削除する                                                           |
| `{行番号}!d`                           | `{行番号}` 行目以外の行を削除する                                                       |
| `{行番号1},{行番号2}d`                 | `{行番号1}` 行目から `{行番号2}` 行目の行を削除する                                     |
| `{行番号1},{行番号2}!d`                | `{行番号1}` 行目から `{行番号2}` 行目以外の行を削除する                                 |
| `/{検索パターン}/d`                    | `{検索パターン}` にマッチする行を削除する                                               |
| `/{検索パターン}/!d`                   | `{検索パターン}` にマッチする行以外の行を削除する                                       |
| `/{検索パターン1}/,/{検索パターン2}/d` | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行を削除する         |
| `/{検索パターン1}/,/検索パターン2/!d`  | `{検索パターン1}` にマッチする行から `{検索パターン2}` にマッチする行以外の行を削除する |
