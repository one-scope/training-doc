[戻る](../README.md)

# シェルオプション（`set`）

シェルオプションはシェルスクリプトの動作を変更する機能です。  
シェルスクリプト内で `set` を使用して各オプションを有効化します。

## `-e` オプション

コマンドが失敗（終了ステータスが 0 以外）した場合にスクリプトの実行を即座に停止させるオプションです。

次の例では、存在しないファイルに対して `ls` コマンドを実行しています。  
`-e` オプションが指定されているため、`ls` コマンドが失敗すると直ちにスクリプトが停止します。  
後続の `echo` コマンドは実行されません。

```bash
#!/bin/bash
set -e
ls non_existent_file
echo "このメッセージは表示されません"
```

## `-u` オプション

未定義の変数を使用した場合にエラーとし、スクリプトを即座に停止させるオプションです。

次の例では、未定義の変数 `undefined_variable` を表示しようとしています。  
`-u` オプションが指定されているため、未定義の変数を使用するとエラーとなり、直ちにスクリプトが停止します。  
後続の `echo` コマンドは実行されません。

```bash
#!/bin/bash
set -u
echo "${undefined_variable}"
echo "このメッセージは表示されません"
```

## `-x` オプション

スクリプト内で実行するコマンドをその都度表示するオプションです。  
デバッグ時に便利です。

```bash
#!/bin/bash
set -x
echo "処理開始"
echo "Hello, World!"
```

実行すると次のように表示されます。

```txt
+ echo 処理開始
処理開始
+ echo 'Hello, World!'
Hello, World!
```

## `-o pipefail` オプション

パイプライン（パイプで繋いだ一連のコマンド）内のいずれかのコマンドが失敗した場合に、パイプライン全体を失敗と見做すオプションです。  
通常、パイプライン内の最後のコマンドだけが終了ステータスとして返されますが、`-o pipefail` を指定すると、途中で発生したエラーも捕らえることができます。  

次の例では、存在しないファイルに対して `ls` コマンドを実行し、その結果を `cat` コマンドに渡すパイプラインが定義されています。  
`-o pipefail` が指定されているため、`ls` コマンドの失敗がパイプライン全体の失敗と見做され、`||` 演算子以降のメッセージが表示されます。

```bash
#!/bin/bash
set -o pipefail
ls non_existent_file | cat || echo "パイプラインが失敗しました"
```

----
[前へ](../07_繰り返し/README.md)
